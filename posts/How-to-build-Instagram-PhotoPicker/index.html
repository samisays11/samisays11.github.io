<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Let‚Äôs Build a Custom Image Picker Just like Instagram Stories" /><meta name="author" content="Samisays11" /><meta property="og:locale" content="en" /><meta name="description" content="What Are We Building ?" /><meta property="og:description" content="What Are We Building ?" /><link rel="canonical" href="https://samisays11.github.io/posts/How-to-build-Instagram-PhotoPicker/" /><meta property="og:url" content="https://samisays11.github.io/posts/How-to-build-Instagram-PhotoPicker/" /><meta property="og:site_name" content="SamiSays11‚Äôs Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-26T22:33:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Let‚Äôs Build a Custom Image Picker Just like Instagram Stories" /><meta name="twitter:site" content="@samisays11" /><meta name="twitter:creator" content="@Samisays11" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Samisays11"},"dateModified":"2022-07-27T10:53:44-05:00","datePublished":"2022-06-26T22:33:00-05:00","description":"What Are We Building ?","headline":"Let‚Äôs Build a Custom Image Picker Just like Instagram Stories","mainEntityOfPage":{"@type":"WebPage","@id":"https://samisays11.github.io/posts/How-to-build-Instagram-PhotoPicker/"},"url":"https://samisays11.github.io/posts/How-to-build-Instagram-PhotoPicker/"}</script><title>Let's Build a Custom Image Picker Just like Instagram Stories | SamiSays11's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="SamiSays11's Blog"><meta name="application-name" content="SamiSays11's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">SamiSays11's Blog</a></div><div class="site-subtitle font-italic">In teaching, we learn twice.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/samisays11" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/samisays11" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['samuel.uyigue','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Let's Build a Custom Image Picker Just like Instagram Stories</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Let's Build a Custom Image Picker Just like Instagram Stories</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1656300780" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 26, 2022 </em> </span> <span> Updated <em class="" data-ts="1658937224" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 27, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Osaretin Uyigue </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4533 words"> <em>25 min</em> read</span></div></div></div><div class="post-content"><h2 id="what-are-we-building-"><span class="mr-2">What Are We Building ?</span><a href="#what-are-we-building-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this tutorial, i will walk you through how to build a clone of <strong>Instagram‚Äôs Story Photo Picker</strong> feature.<br /> If you are not familiar with what that looks like there is a gif demo of it below. For clarity we will be focusing exclusively on the custom photo picker functionality. All the user-interface, gesture animations, and transition animation related code are in the <a href="https://github.com/samisays11/InstaPhotoPicker"><strong>Starter Project</strong></a>.</p><h5> <details> <summary> Dev Environment </summary> Swift 5, iOS 14, Xcode 13.4.1 </details></h5><p><img data-src="/assets/img/demo.gif" alt="Desktop View" class="shadow" data-proofer-ignore> <em>Project Demo</em></p><h2 id="what-youll-learn"><span class="mr-2">What You‚Äôll Learn</span><a href="#what-youll-learn" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Have you ever wondered how 3rd party apps like Instagram or Snapchat can access the photo library so seamlessly to retrieve and display our photos and albums in their custom made UIs? PhotoKit is the magical framework that makes that possible.</p><p>At the end of this tutorial you‚Äôll know:</p><ul class="task-list"><li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />How to Setup and Ask for User‚Äôs Photo Library Permission.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />How to Fetch Smart Albums and User-Created Albums.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />How to Fetch all Photo Assets in a Specific Album.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />How to Retrieve Images from Assets.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />How to use the retrieved PHAssets and PHAssetCollections to power our UI.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />How to use the PHPickerViewController to Search and Select specific Photo Assets.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />How to use the PHPhotoLibraryChangeObserver protocol to keep our assets up to date.</ul><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 150'%3E%3C/svg%3E" data-src="https://c.tenor.com/TPXMriXwLD4AAAAC/lets-go-the-rock.gif" alt="Desktop View" class="left" width="300" height="150" data-proofer-ignore></p><p><br /><br /> <br /><br /> <br /><br /> <br /><br /></p><h2 id="getting-started"><span class="mr-2">Getting Started</span><a href="#getting-started" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Like many privacy-centric iOS APIs, the PhotoKit requires us to request the user‚Äôs permission before we can access the user‚Äôs photo library. To get this permission, we use the <strong>PHPhotoLibrary</strong>, a shared object that manages access to the photo library.</p><h3 id="modifying-infoplist-before-requesting-authorization"><span class="mr-2">Modifying Info.plist Before Requesting Authorization</span><a href="#modifying-infoplist-before-requesting-authorization" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Download the <a href="https://github.com/samisays11/InstaPhotoPicker"><strong>Starter Project</strong></a> and open the <strong>starter</strong> folder. Double click on the <span style="background-color: #FFFF00"><strong>InstaPhotoPicker.xcodeproj</strong></span> file and navigate to the <strong>info.plist</strong> file in the root directory. The first step to <strong>Requesting Authorization</strong> is to add a key to the <strong>Info.plist</strong> file that explains why you need permission to access the user‚Äôs photo library. To do this you will need to:</p><ol><li>Open the <strong>Info.plist</strong> file.<li>Right-click <strong>Information Property List</strong> and select the <strong>Add Row</strong> option. A new line will be displayed.<li>Start typing <span style="background-color: #FFFF00"><strong>Privacy - Photo Library Usage Description</strong></span> in the new row‚Äôs Key column and press enter.<li>In the Value column, type in whatever usage description you want the alert dialog to show the user the first time iOS request for permission. For this tutorial we‚Äôll just go with <span style="background-color: #FFFF00"><strong>‚ÄúAccess to Photo Library Allows you to upload media from your Camera Roll to InstaPhotoPicker‚Äù</strong></span> as our request description.</ol><p>Your <strong>Info.plist</strong> should look like this: <img data-src="/assets/img/info.plist.sc.png" data-proofer-ignore></p><h3 id="requesting-authorization-to-access-users-photo-library"><span class="mr-2">Requesting Authorization to Access User‚Äôs Photo Library</span><a href="#requesting-authorization-to-access-users-photo-library" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Open your ViewController.swift file in the starter project and add the following code inside your <strong>getPhotoPermission</strong> method in the Photokit section:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="c1">//MARK: - Photokit</span>
 <span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">getPhotoPermission</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span><span class="p">(</span><span class="kt">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="c1">// 1 </span>
        <span class="k">guard</span> <span class="kt">PHPhotoLibrary</span><span class="o">.</span><span class="nf">authorizationStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="o">.</span><span class="n">authorized</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">completionHandler</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="c1">// 2 </span>
        <span class="kt">PHPhotoLibrary</span><span class="o">.</span><span class="nf">requestAuthorization</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">readWrite</span><span class="p">)</span> <span class="p">{</span> <span class="n">status</span> <span class="k">in</span>
            <span class="k">switch</span> <span class="n">status</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">notDetermined</span><span class="p">:</span>
                <span class="c1">// The user hasn't determined this app's access.</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"notDetermined"</span><span class="p">)</span>
                <span class="c1">//                completionHandler(false)</span>
                
            <span class="k">case</span> <span class="o">.</span><span class="nv">restricted</span><span class="p">:</span>
                <span class="c1">// The system restricted this app's access.</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"restricted"</span><span class="p">)</span>
                <span class="nf">completionHandler</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
                
            <span class="k">case</span> <span class="o">.</span><span class="nv">denied</span><span class="p">:</span>
                <span class="c1">// The user explicitly denied this app's access.</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"denied"</span><span class="p">)</span>
                <span class="nf">completionHandler</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
                
            <span class="k">case</span> <span class="o">.</span><span class="nv">authorized</span><span class="p">:</span>
                <span class="c1">// The user authorized this app to access Photos data.</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"authorized"</span><span class="p">)</span>
                <span class="nf">completionHandler</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
                
                
            <span class="k">case</span> <span class="o">.</span><span class="nv">limited</span><span class="p">:</span>
                <span class="c1">// The user authorized this app for limited Photos access.</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"limited"</span><span class="p">)</span>
                <span class="nf">completionHandler</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
                
            <span class="kd">@unknown</span> <span class="k">default</span><span class="p">:</span>
                <span class="nf">fatalError</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
</pre></table></code></div></div><ol><li><p>This gets us the current authorization status from PHPhotoLibrary. If we‚Äôve already been granted authorization from prior prompts, we call the completion handler with a value of true and return out of the method.</p><li><p>If authorization has not been previously granted or requested, we request it. When requesting authorization, iOS displays an alert that asks for user‚Äôs permission, upon user‚Äôs selection it passes back the user‚Äôs selection as a <strong>PHAuthorizationStatus</strong> object. We then call our completion handler and return true if the status (PHAuthorizationStatus) value is .authorized, or .limited, otherwise we return false.</p></ol><blockquote class="prompt-info"><div><p><strong>Note:</strong> Prior to iOS 14 PHAuthorizationStatus enum, did not contain a .limited, or .restricted status options. This is something to keep in mind if you‚Äôre also building for iOS 13 and below.</p></div></blockquote><h3 id="finalizing-authorization"><span class="mr-2">Finalizing Authorization</span><a href="#finalizing-authorization" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Run the project, click on the <strong>Enable photo access</strong> button. On tap iOS will ask for permission to let InstaPhotoPicker access the photo library. If you are building for iOS 13 or less tap <strong>OK</strong>, on iOS 14 tap <strong>Allow Access to All Photos</strong>.</p><p><img data-src="/assets/img/alertDialogImage.png" data-proofer-ignore></p><p>Great job! and just like that we are done with:</p><ul class="task-list"><li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to Setup and Ask for User‚Äôs Photo Library Permission.</ul><h2 id="understanding-photokits-main-objects"><span class="mr-2">Understanding Photokit‚Äôs Main Objects</span><a href="#understanding-photokits-main-objects" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Before we proceed to actually fetching photos and videos. It‚Äôs important you get a quick overview of the main objects we will be working with. When working with PhotoKit, we‚Äôll be dealing alot with these 3 objects:</p><details> <summary> PHAssets </summary> TL;DR &rarr; Basically a metadata that represents an image, video, or Live Photo in the Photos library. </details> <details> <summary> PHAssetCollections </summary> TL;DR &rarr; A group of PHAssets. Basically a user-created album, or an ios smart album. </details> <details> <summary> PHFetchResults </summary> TL;DR &rarr; Basically PhotosKit's smart array that fetches and auto caches objects like PHAssets or PHAssetCollection. </details><p><br /></p><p><strong>PHAssets</strong> <br /> First let‚Äôs make something absolutely clear, the <strong>PHAsset</strong> object is not an actual video or photo object. Don‚Äôt confuse it for a UIImage object. It‚Äôs a metadata that represents the image, LivePhoto, or video as it resides in the user‚Äôs photo library. It‚Äôs an immutable object that provide us the information we need to get the actual UIImage object or video URL, along with tons of other informations about them like their creation and modification dates, location data, favorite and hidden status etc.</p><p><strong>PHAssetCollections</strong> <br /> Sometimes you need to retrieve a group of assets, like in the case of an album in the user‚Äôs photo library. These are usually returned as a PHAssetCollection object. In essence, this is PhotosKit‚Äôs representation of an Album or Moment in the photo library.</p><p><strong>PHFetchResult</strong> <br /> A simplified way of thinking of PHFetchResult is to consider it an array, which it is. It contains all the same methods and conventions of arrays, such as count() and index(of:). Plus, it intelligently handles fetching data, caching it and re-fetching it as needed. You‚Äôll be fine if you think of PHFetchResult as an intelligent array of assets or collections.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 800'%3E%3C/svg%3E" data-src="https://c.tenor.com/A-ozELwp694AAAAC/thumbs-thumbs-up-kid.gif" alt="Desktop View" class="shadow" width="800" height="800" data-proofer-ignore> <em>Ok that makes sense üëç</em></p><h2 id="setting-up-photo-assets-data-models"><span class="mr-2">Setting Up Photo Asset‚Äôs Data Models</span><a href="#setting-up-photo-assets-data-models" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that you got the gist of the main objects we will be using to fetch our photos and albums, it‚Äôs time to set up our data models. Still in our ViewController.swift, at the top of the file, add these under the marked Properties sections:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//MARK: - Properties</span>
 <span class="c1">// 1</span>
 <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">allPhotosInCurrentAlbum</span> <span class="o">=</span> <span class="kt">PHFetchResult</span><span class="o">&lt;</span><span class="kt">PHAsset</span><span class="o">&gt;</span><span class="p">()</span>
 <span class="c1">// 2</span>
 <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">smartAlbums</span> <span class="o">=</span> <span class="p">[</span><span class="kt">PHAssetCollection</span><span class="p">]()</span>
 <span class="c1">// 3</span>
 <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">userCreatedAlbums</span> <span class="o">=</span> <span class="kt">PHFetchResult</span><span class="o">&lt;</span><span class="kt">PHAssetCollection</span><span class="o">&gt;</span><span class="p">()</span>
 <span class="c1">// 4</span>
 <span class="kd">fileprivate</span> <span class="k">let</span> <span class="nv">listOfsmartAlbumSubtypesToBeFetched</span><span class="p">:</span> <span class="p">[</span><span class="kt">PHAssetCollectionSubtype</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">smartAlbumUserLibrary</span><span class="p">,</span> <span class="o">.</span><span class="n">smartAlbumFavorites</span><span class="p">,</span> <span class="o">.</span><span class="n">smartAlbumVideos</span><span class="p">,</span> <span class="o">.</span><span class="n">smartAlbumScreenshots</span><span class="p">]</span>

</pre></table></code></div></div><p>For simplicity, i will be referring to PHFetchResult as a smart-array.</p><ol><li><p>In essence, think of it as initializing an empty smart-array we will use in holding all the photos and videos we will be fetching from the photos library.</p><li><p>Initializing a regular array to hold the four smart-albums we will be fetching.</p><li><p>Initializing a smart-array that will hold all the user-created albums.</p><li><p>We will only be fetching those four distinct smart-albums from the photo library. This is a list we will use to filter for them. You might be thinking, ‚ÄúHey, what is this <strong>PHAssetCollectionSubtype</strong> thing ?‚Äù Well, PHAssetCollectionSubtype is simply an enumerable value that describes the particular subtype of a PHAssetCollection. Basically a way for us to specify which exact smart albums we want to fetch.</p></ol><p><br /><br /></p><h2 id="Fetching-The-Assets"><span class="mr-2">Fetching Photo Assets and Albums</span><a href="#Fetching-The-Assets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Still in the ViewController.swift file go to the <strong>fetchPhotoLibraryAssets</strong> method below the marked Photokit section and add the following code ‚Üì</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="c1">//MARK: - PhotoKits</span>
 <span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">fetchPhotoLibraryAssets</span><span class="p">()</span> <span class="p">{</span>
        
        <span class="c1">// 1</span>
        <span class="k">let</span> <span class="nv">authStatus</span> <span class="o">=</span> <span class="kt">PHPhotoLibrary</span><span class="o">.</span><span class="nf">authorizationStatus</span><span class="p">()</span>
        <span class="k">guard</span> <span class="n">authStatus</span> <span class="o">==</span>  <span class="o">.</span><span class="n">authorized</span> <span class="o">||</span> <span class="n">authStatus</span> <span class="o">==</span> <span class="o">.</span><span class="n">limited</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
        
        <span class="c1">// 2</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">askPhotoPermissionView</span><span class="o">.</span><span class="nf">updateTexts</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1">// 3</span>
        <span class="k">for</span> <span class="n">collectionSubType</span> <span class="k">in</span>  <span class="n">listOfsmartAlbumSubtypesToBeFetched</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">smartAlbum</span> <span class="o">=</span> <span class="kt">PHAssetCollection</span><span class="o">.</span><span class="nf">fetchAssetCollections</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">smartAlbum</span><span class="p">,</span> <span class="nv">subtype</span><span class="p">:</span> <span class="n">collectionSubType</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span><span class="o">.</span><span class="n">firstObject</span> <span class="p">{</span>
                <span class="n">smartAlbums</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">smartAlbum</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1">// 4</span>
        <span class="k">let</span> <span class="nv">userCreatedAlbumsOptions</span> <span class="o">=</span> <span class="kt">PHFetchOptions</span><span class="p">()</span>
        <span class="n">userCreatedAlbumsOptions</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="kt">NSPredicate</span><span class="p">(</span><span class="nv">format</span><span class="p">:</span> <span class="s">"estimatedAssetCount &gt; 0"</span><span class="p">)</span>
        <span class="n">userCreatedAlbums</span> <span class="o">=</span> <span class="kt">PHAssetCollection</span><span class="o">.</span><span class="nf">fetchAssetCollections</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">album</span><span class="p">,</span> <span class="nv">subtype</span><span class="p">:</span> <span class="o">.</span><span class="n">albumRegular</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">userCreatedAlbumsOptions</span><span class="p">)</span>

        <span class="c1">// 5</span>
        <span class="k">let</span> <span class="nv">fetchOptions</span> <span class="o">=</span> <span class="kt">PHFetchOptions</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">sortDescriptor</span> <span class="o">=</span> <span class="kt">NSSortDescriptor</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"creationDate"</span><span class="p">,</span> <span class="nv">ascending</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
        <span class="n">fetchOptions</span><span class="o">.</span><span class="n">sortDescriptors</span> <span class="o">=</span> <span class="p">[</span><span class="n">sortDescriptor</span><span class="p">]</span>
        <span class="n">allPhotosInCurrentAlbum</span> <span class="o">=</span> <span class="kt">PHAsset</span><span class="o">.</span><span class="nf">fetchAssets</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">fetchOptions</span><span class="p">)</span>

        <span class="c1">// 6</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">mediaPickerView</span><span class="o">.</span><span class="nf">bindDataFromPhotosLibrary</span><span class="p">(</span><span class="nv">fetchedAssets</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">allPhotosInCurrentAlbum</span><span class="p">,</span> <span class="nv">albumTitle</span><span class="p">:</span> <span class="s">"Recents"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
</pre></table></code></div></div><ol><li><p>This gets us the current authorization status from PHPhotoLibrary. If we‚Äôve not been granted authorization, we return out of the method.</p><li><p>This updates a UILabel‚Äôs text in the askPhotoPermissionView. Since the PhotoKit‚Äôs methods runs in the background thread, it‚Äôs important to update UI related stuff on the main thread.</p><li><p>When retrieving assets from the photo library with PHFetchResult, we can use a PHAssetCollectionSubtype object to retrieve a specific type of smart album. Here, we loop through our <strong>listOfsmartAlbumSubtypesToBeFetched</strong> and then we use the PHAssetCollection‚Äôs fetchAssetCollection method to fetch and append the recent, favorites, videos, and screenshot smart albums to the <strong>smartAlbums</strong> array we declared earlier.</p><li><p>When retrieving user created albums or smart albums, we can use a PHFetchOptions object to apply a set of sorting paramters to indicate how we would like the retrieved assets to be sorted. Here, we create a PHFetchOptions object and use a predicate to specify that we only want to fetch user created albums that contains at least one photo or video asset.</p><li><p>Here we create a sort descriptor that sorts assets by creation date from newest to oldest, and then we apply it to our PHFetchOptions object, before we use the PHAsset‚Äôs fetchAssets method to retrieve all the photo and video assets in the photo library.</p><li><p>PhotoKit‚Äôs methods runs in the background thread, so we jump to the main thread to pass our retrieved assets to the mediaPickerView for UI update.</p></ol><h2 id="displaying-all-photo-assets"><span class="mr-2">Displaying All Photo Assets</span><a href="#displaying-all-photo-assets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that we are done fetching data from the Photo Library‚Äôs Data Store let‚Äôs display them in our UI.<br /> Navigate to <strong>MediaPickerView.swift</strong> file in the Views folder and replace the collectionView‚Äôs <strong>cellforItem</strong>, <strong>numberOfItemsInSection</strong> and <strong>didSelectItem</strong> methods at the end of the class with these:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c1">// 1</span>
 <span class="kd">func</span> <span class="nf">collectionView</span><span class="p">(</span><span class="n">_</span> <span class="nv">collectionView</span><span class="p">:</span> <span class="kt">UICollectionView</span><span class="p">,</span> <span class="n">cellForItemAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UICollectionViewCell</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">cell</span> <span class="o">=</span> <span class="n">collectionView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withReuseIdentifier</span><span class="p">:</span> <span class="kt">PhotoCell</span><span class="o">.</span><span class="n">cellReuseIdentifier</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span> <span class="k">as!</span> <span class="kt">PhotoCell</span>
        <span class="n">cell</span><span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">asset</span><span class="p">:</span> <span class="n">allPhotosInSelectedAlbum</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">item</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cell</span>
  <span class="p">}</span>

<span class="c1">// 2</span>
 <span class="kd">func</span> <span class="nf">collectionView</span><span class="p">(</span><span class="n">_</span> <span class="nv">collectionView</span><span class="p">:</span> <span class="kt">UICollectionView</span><span class="p">,</span> <span class="n">numberOfItemsInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">allPhotosInSelectedAlbum</span><span class="o">.</span><span class="n">count</span>
  <span class="p">}</span>


<span class="c1">// 3</span>
 <span class="kd">func</span> <span class="nf">collectionView</span><span class="p">(</span><span class="n">_</span> <span class="nv">collectionView</span><span class="p">:</span> <span class="kt">UICollectionView</span><span class="p">,</span> <span class="n">didSelectItemAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">guard</span> <span class="k">let</span> <span class="nv">cell</span> <span class="o">=</span> <span class="n">collectionView</span><span class="o">.</span><span class="nf">cellForItem</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">PhotoCell</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
      <span class="k">let</span> <span class="nv">asset</span> <span class="o">=</span> <span class="n">allPhotosInSelectedAlbum</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">item</span><span class="p">]</span>
      <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="nf">getAssetThumbnail</span><span class="p">(</span><span class="nv">asset</span><span class="p">:</span> <span class="n">asset</span><span class="p">,</span> <span class="nv">size</span><span class="p">:</span> <span class="kt">PHImageManagerMaximumSize</span><span class="p">)</span>
      <span class="n">cell</span><span class="o">.</span><span class="n">thumbnailImageView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
      <span class="n">delegate</span><span class="p">?</span><span class="o">.</span><span class="nf">handleTransitionToStoriesEditorVC</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">cell</span><span class="o">.</span><span class="n">thumbnailImageView</span><span class="p">)</span>
    <span class="p">}</span>

</pre></table></code></div></div><ol><li><p>Here we are binding each photo‚Äôs asset to each individual cell‚Äôs UI.</p><li><p>Here is a good example of how you treat PHFetchResult as an array. We are Returning the number of assets in the PHFetchResult as the number of items in the collectionView.</p><li><p>Here we are getting the selected cell‚Äôs imageView and asset, then calling the <strong>getAssetThumbnail</strong> method to fetch the asset‚Äôs highest quality image. Then a delegate to handle the transition animation to StoriesEditorVC.</p></ol><blockquote class="prompt-info"><div><p><strong>Note:</strong> To request the maximum possible size for a PHAsset‚Äôs image we use the <strong>PHImageManagerMaximumSize</strong>.</p></div></blockquote><h2 id="getting-uiimage-from-photo-asset"><span class="mr-2">Getting UIImage from Photo Asset</span><a href="#getting-uiimage-from-photo-asset" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The <strong>getAssetThumbnail</strong> method in the Constants.swift file inside the Misc folder is responsible for requesting a PHAsset‚Äôs image from the PHImageManager. In essence, this is how we convert a PHAsset object to a UIImage object. I suggest you click on the method and take a look at the code:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">func</span> <span class="nf">getAssetThumbnail</span><span class="p">(</span><span class="nv">asset</span><span class="p">:</span> <span class="kt">PHAsset</span><span class="p">,</span> <span class="nv">size</span><span class="p">:</span> <span class="kt">CGSize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIImage</span><span class="p">?</span> <span class="p">{</span>
    <span class="c1">// 1</span>
    <span class="k">let</span> <span class="nv">manager</span> <span class="o">=</span> <span class="kt">PHImageManager</span><span class="o">.</span><span class="nf">default</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">options</span> <span class="o">=</span> <span class="kt">PHImageRequestOptions</span><span class="p">()</span>
    <span class="n">options</span><span class="o">.</span><span class="n">isSynchronous</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="n">options</span><span class="o">.</span><span class="n">isNetworkAccessAllowed</span> <span class="o">=</span> <span class="kc">true</span>
    
    <span class="k">var</span> <span class="nv">thumbnail</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">?</span>
    <span class="c1">// 2</span>
    <span class="n">manager</span><span class="o">.</span><span class="nf">requestImage</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">asset</span><span class="p">,</span> <span class="nv">targetSize</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span> <span class="nv">contentMode</span><span class="p">:</span> <span class="o">.</span><span class="n">aspectFill</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">options</span><span class="p">)</span> <span class="p">{(</span><span class="n">imageReturned</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">thumbnailUnwrapped</span> <span class="o">=</span> <span class="n">imageReturned</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
        <span class="n">thumbnail</span> <span class="o">=</span> <span class="n">thumbnailUnwrapped</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">thumbnail</span>
<span class="p">}</span>
</pre></table></code></div></div><ol><li>We instantiate PHImageManager with PHImageRequestOptions.<li>Here we are requesting the image from the image manager. Providing the asset, size, content mode, and options. Size is the size at which you would like the image returned. contentMode is how you would like the image to fit within the aspect ratio of the size. The default value is aspectFill. And then finally we return the requested image in the result handler.</ol><p><br /><br /></p><p>Alright now that we are done discussing how we fetch images from assets let‚Äôs build and run the project. In the app swipe up to view all the photos in the user‚Äôs photo library.</p><p><img data-src="/assets/img/projectDemo2.gif" alt="Desktop View" class="shadow" data-proofer-ignore> <em>Hooray üôå‚úäü•≥üéâüëè our collectionview now has images!</em></p><ul class="task-list"><li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to Retrieve Images from Assets.</ul><h2 id="displaying-album-assets"><span class="mr-2">Displaying Album Assets</span><a href="#displaying-album-assets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Navigate back to the <strong>ViewController.swift</strong> file and find the <strong>handleOpenAlbumVC</strong> method in the marked <strong>MediaPickerViewDelegate</strong> section. Replace the code in the <strong>handleOpenAlbumVC</strong> method with the one below:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//MARK: - MediaPickerViewDelegate</span>
<span class="kd">func</span> <span class="nf">handleOpenAlbumVC</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 1</span>
     <span class="k">let</span> <span class="nv">albumVC</span> <span class="o">=</span> <span class="kt">AlbumVC</span><span class="p">(</span><span class="nv">smartAlbums</span><span class="p">:</span> <span class="n">smartAlbums</span><span class="p">,</span> <span class="nv">userCreatedAlbums</span><span class="p">:</span> <span class="n">userCreatedAlbums</span><span class="p">)</span>
     <span class="n">albumVC</span><span class="o">.</span><span class="n">modalPresentationStyle</span> <span class="o">=</span> <span class="o">.</span><span class="n">custom</span>
     <span class="n">albumVC</span><span class="o">.</span><span class="n">transitioningDelegate</span> <span class="o">=</span> <span class="k">self</span>
     <span class="n">albumVC</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
     <span class="nf">present</span><span class="p">(</span><span class="n">albumVC</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><ol><li>Here we are injecting the smart albums and user created albums we fetched into the albumVC initializer right before the albumVC is modally presented.</ol><p>Now with the AlbumVC injected with the album assets, let‚Äôs use the assets to display the albums.<br /> Displaying the cover image for an album is simply a matter of requesting each album‚Äôs cover image from the PHImageManager. The AlbumVC is almost set up to display albums, let us complete the setup process and get it working.</p><p>Head to the <strong>AlbumVC.swift</strong> file in the Controllers folder and add this below the marked properties section:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// 1</span>
<span class="kd">fileprivate</span> <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">smartAlbumSection</span> <span class="o">=</span> <span class="p">[</span><span class="kt">SmartAlbumItem</span><span class="p">(</span><span class="nv">albumName</span><span class="p">:</span> <span class="s">"Search"</span><span class="p">,</span> <span class="nv">imageName</span><span class="p">:</span> <span class="s">"magnifyingglass"</span><span class="p">),</span>
                                          <span class="kt">SmartAlbumItem</span><span class="p">(</span><span class="nv">albumName</span><span class="p">:</span> <span class="s">"Recents"</span><span class="p">,</span> <span class="nv">imageName</span><span class="p">:</span> <span class="s">"clock"</span><span class="p">,</span> <span class="nv">collection</span><span class="p">:</span> <span class="n">smartAlbums</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                          <span class="kt">SmartAlbumItem</span><span class="p">(</span><span class="nv">albumName</span><span class="p">:</span> <span class="s">"Favorites"</span><span class="p">,</span> <span class="nv">imageName</span><span class="p">:</span> <span class="s">"heart"</span><span class="p">,</span> <span class="nv">collection</span><span class="p">:</span> <span class="n">smartAlbums</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                          <span class="kt">SmartAlbumItem</span><span class="p">(</span><span class="nv">albumName</span><span class="p">:</span> <span class="s">"Videos"</span><span class="p">,</span> <span class="nv">imageName</span><span class="p">:</span> <span class="s">"play.circle"</span><span class="p">,</span> <span class="nv">collection</span><span class="p">:</span> <span class="n">smartAlbums</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                                          <span class="kt">SmartAlbumItem</span><span class="p">(</span><span class="nv">albumName</span><span class="p">:</span> <span class="s">"Screenshots"</span><span class="p">,</span> <span class="nv">imageName</span><span class="p">:</span> <span class="s">"iphone"</span><span class="p">,</span> <span class="nv">collection</span><span class="p">:</span> <span class="n">smartAlbums</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="p">]</span>
</pre></table></code></div></div><ol><li>The smartAlbumSection is an array of SmartAlbumItems. This is a simple struct to power our tableView‚Äôs first section. Each item holds a albumName, imageName, and an optional PHAssetCollection(the actual smart-album). The PHAssetCollection property of the SmartAlbumItem is optional because we know the first item (the Search item) in the smartAlbumSection array will not a have a PHAssetCollection property.</ol><p>Now scroll to the marked <strong>TableView Protocols</strong> section and let‚Äôs update the tableView‚Äôs cellForRowAt, didSelectRowAt, and numberOfRowsInSection methods to display our album‚Äôs UI:</p><p>Add the <strong>cellForRowAt</strong> method</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">cellForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">sectionType</span> <span class="o">=</span> <span class="n">albumSections</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">section</span><span class="p">]</span>
        <span class="k">switch</span> <span class="n">sectionType</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">smartAlbums</span><span class="p">:</span>
            <span class="k">let</span> <span class="nv">smartAlbumCell</span> <span class="o">=</span> <span class="nf">dequeSmartAlbumCell</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">smartAlbumCell</span>
        <span class="k">case</span>  <span class="o">.</span><span class="nv">userCreatedAlbums</span><span class="p">:</span>
            <span class="k">let</span> <span class="nv">userCreatedAlbumCell</span> <span class="o">=</span> <span class="nf">dequeUserCreatedAlbumCell</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">userCreatedAlbumCell</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
</pre></table></code></div></div><p>Here we deque each cell based on the album section type. Where section 0 is a smartAlbumCell and 1 is a userCreatedAlbumCell.</p><p>Above the cellForRowAt method update the <strong>dequeSmartAlbumCell</strong> method:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">dequeSmartAlbumCell</span><span class="p">(</span><span class="k">for</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>
        <span class="c1">//1 cell dequeing</span>
         <span class="k">let</span> <span class="nv">smartAlbumCell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="n">smartAlbumCellIdentifier</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span>
         <span class="n">smartAlbumCell</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">clear</span>
         <span class="n">smartAlbumCell</span><span class="o">.</span><span class="n">selectionStyle</span> <span class="o">=</span> <span class="o">.</span><span class="k">none</span>
        
        <span class="c1">//2 configuring SmartAlbumCell's UI and data binding</span>
        <span class="k">let</span> <span class="nv">album</span> <span class="o">=</span> <span class="n">smartAlbumSection</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span>
        <span class="k">var</span> <span class="nv">contentConfig</span> <span class="o">=</span> <span class="n">smartAlbumCell</span><span class="o">.</span><span class="nf">defaultContentConfiguration</span><span class="p">()</span>
        <span class="n">contentConfig</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">album</span><span class="o">.</span><span class="n">albumName</span>
        
        <span class="k">let</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="o">.</span><span class="kt">SymbolConfiguration</span><span class="p">(</span><span class="nv">pointSize</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="nv">weight</span><span class="p">:</span> <span class="o">.</span><span class="n">semibold</span><span class="p">,</span> <span class="nv">scale</span><span class="p">:</span> <span class="o">.</span><span class="n">large</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="n">album</span><span class="o">.</span><span class="n">imageName</span><span class="p">,</span> <span class="nv">withConfiguration</span><span class="p">:</span>
                                <span class="n">config</span><span class="p">)?</span><span class="o">.</span><span class="nf">withRenderingMode</span><span class="p">(</span><span class="o">.</span><span class="n">alwaysTemplate</span><span class="p">)</span>

        <span class="n">contentConfig</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
        <span class="n">contentConfig</span><span class="o">.</span><span class="n">imageProperties</span><span class="o">.</span><span class="n">tintColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">white</span>
        <span class="n">contentConfig</span><span class="o">.</span><span class="n">textProperties</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="o">.</span><span class="n">white</span>
        <span class="n">contentConfig</span><span class="o">.</span><span class="n">imageToTextPadding</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">smartAlbumCell</span><span class="o">.</span><span class="n">contentConfiguration</span> <span class="o">=</span> <span class="n">contentConfig</span>
        
         <span class="k">return</span> <span class="n">smartAlbumCell</span>
     <span class="p">}</span>
</pre></table></code></div></div><ol><li>Here we are dequeing each smartAlbumCell.<li>Configuring each smartAlbumCell with the new iOS 14.0+ tableview cell‚Äôs UI configurations. Then binding the smartAlbumSection data to display each smartAlbumCell‚Äôs title and icon.</ol><p>Right below the dequeSmartAlbumCell method, update the <strong>dequeUserCreatedAlbumCell</strong> method:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">dequeUserCreatedAlbumCell</span><span class="p">(</span><span class="k">for</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AlbumCell</span> <span class="p">{</span>
         
         <span class="c1">// 1</span>
         <span class="k">let</span> <span class="nv">userCreatedAlbumCell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="n">userCreatedAlbumCellIdentifier</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span> <span class="k">as!</span> <span class="kt">AlbumCell</span>
         <span class="n">userCreatedAlbumCell</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">clear</span>
         <span class="n">userCreatedAlbumCell</span><span class="o">.</span><span class="n">selectionStyle</span> <span class="o">=</span> <span class="o">.</span><span class="k">none</span>
         
         <span class="c1">// 2</span>
         <span class="k">var</span> <span class="nv">coverAsset</span><span class="p">:</span> <span class="kt">PHAsset</span><span class="p">?</span>
         <span class="k">let</span> <span class="nv">aUserCreatedAlbum</span> <span class="o">=</span> <span class="n">userCreatedAlbums</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">item</span><span class="p">]</span>

         <span class="c1">// 3</span>
         <span class="k">let</span> <span class="nv">fetchOptions</span> <span class="o">=</span> <span class="kt">PHFetchOptions</span><span class="p">()</span>
         <span class="n">fetchOptions</span><span class="o">.</span><span class="n">fetchLimit</span> <span class="o">=</span> <span class="mi">1</span>
         <span class="k">let</span> <span class="nv">sortDescriptor</span> <span class="o">=</span> <span class="kt">NSSortDescriptor</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"creationDate"</span><span class="p">,</span> <span class="nv">ascending</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
         <span class="n">fetchOptions</span><span class="o">.</span><span class="n">sortDescriptors</span> <span class="o">=</span> <span class="p">[</span><span class="n">sortDescriptor</span><span class="p">]</span>
         
         <span class="c1">// 4</span>
         <span class="k">let</span> <span class="nv">fetchedAssets</span> <span class="o">=</span> <span class="kt">PHAsset</span><span class="o">.</span><span class="nf">fetchAssets</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">aUserCreatedAlbum</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">fetchOptions</span><span class="p">)</span>
         <span class="n">coverAsset</span> <span class="o">=</span> <span class="n">fetchedAssets</span><span class="o">.</span><span class="n">firstObject</span>
         <span class="k">guard</span> <span class="k">let</span> <span class="nv">asset</span> <span class="o">=</span> <span class="n">coverAsset</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="n">userCreatedAlbumCell</span> <span class="p">}</span>
         
         <span class="c1">// 5</span>
         <span class="k">let</span> <span class="nv">coverImage</span> <span class="o">=</span> <span class="nf">getAssetThumbnail</span><span class="p">(</span><span class="nv">asset</span><span class="p">:</span> <span class="n">asset</span><span class="p">,</span> <span class="nv">size</span><span class="p">:</span> <span class="n">userCreatedAlbumCell</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
         <span class="n">userCreatedAlbumCell</span><span class="o">.</span><span class="nf">bindData</span><span class="p">(</span><span class="nv">albumTitle</span><span class="p">:</span> <span class="n">aUserCreatedAlbum</span><span class="o">.</span><span class="n">localizedTitle</span> <span class="p">??</span> <span class="s">""</span><span class="p">,</span> <span class="nv">albumCoverImage</span><span class="p">:</span> <span class="n">coverImage</span><span class="p">)</span>
         
         <span class="k">return</span> <span class="n">userCreatedAlbumCell</span>
     <span class="p">}</span>
</pre></table></code></div></div><ol><li><p>Here we are dequeing each userCreatedAlbumCell.</p><li><p>Here we create variables to hold an album‚Äôs photo asset, which we‚Äôll use as the album‚Äôs cover image. And another variable to get each user-created album‚Äôs asset from our smart album assets.</p><li><p>Since we only want to fetch the most recent image in each user-created album, we use PHFetchOptions‚Äôs fetchLimit and sortDescriptor to limit our fetch result to the most recently added asset in the album.</p><li><p>We retrieve the album‚Äôs first asset using the PHAsset‚Äôs fetchAssets method (which is a PHFetchResult object) and set it as the cover asset.</p><li><p>We grab the cover asset‚Äôs image from PhotoKit‚Äôs PHImageManager using our getAssetThumbnail method and then bind the title and image data to power our album cell‚Äôs UI.</p></ol><p>Add the <strong>numberOfRowsInSection</strong> method</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">numberOfRowsInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">albumSections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">smartAlbums</span><span class="p">:</span> <span class="k">return</span> <span class="n">smartAlbumSection</span><span class="o">.</span><span class="n">count</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">userCreatedAlbums</span><span class="p">:</span> <span class="k">return</span> <span class="n">userCreatedAlbums</span><span class="o">.</span><span class="n">count</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
</pre></table></code></div></div><p>Here we return the number of items in each section based on the album section type, so the tableView knows how many items to display in each section.</p><p>Add the <strong>didSelectRowAt</strong> method</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">didSelectRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">albumSections</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">section</span><span class="p">]</span> <span class="p">{</span>
        <span class="c1">//1</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">smartAlbums</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="k">let</span> <span class="nv">smartAlbum</span> <span class="o">=</span> <span class="n">smartAlbumSection</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">collection</span> <span class="p">{</span>
                <span class="n">delegate</span><span class="p">?</span><span class="o">.</span><span class="nf">handleDidSelect</span><span class="p">(</span><span class="nv">album</span><span class="p">:</span> <span class="n">smartAlbum</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">delegate</span><span class="p">?</span><span class="o">.</span><span class="nf">handlePresentPHPickerViewController</span><span class="p">()</span>
            <span class="p">}</span>
            
            <span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        <span class="c1">// 2    </span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">userCreatedAlbums</span><span class="p">:</span>
            <span class="n">delegate</span><span class="p">?</span><span class="o">.</span><span class="nf">handleDidSelect</span><span class="p">(</span><span class="nv">album</span><span class="p">:</span> <span class="n">userCreatedAlbums</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">])</span>
            <span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
</pre></table></code></div></div><ol><li><p>When the user selects an item in the smart-album section, we delegate the action to the parent ViewController.swift file, which is responsible for fetching all the photo or video assets in the selected album. Then we dismiss the AlbumVC. And if the user selects the search item we also delegate the ViewController.swift to present a PHPickerViewController, more on that later.</p><li><p>On selection of an item in the user created-albums section we delegate the action to the ViewController.swift file and dismiss the AlbumVC.</p></ol><p>Run the project and open the albums. You should see albums with their names and cover images being displayed! Hooray üôå‚úäü•≥üéâüëè we are done displaying albums, all that‚Äôs left is changing our mediaPickerView‚Äôs photo assets to show the selected album‚Äôs photo assets when didSelectRow method is triggered in the AlbumVC.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 800'%3E%3C/svg%3E" data-src="/assets/img/openingAlbumDemo.gif" alt="Desktop View" class="shadow" width="800" height="800" data-proofer-ignore> <em>Hooray üôå‚úäü•≥üéâüëè we can now see our albums!</em></p><ul class="task-list"><li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to Fetch Smart Albums and User-Created Albums.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to use the retrieved PHAssets and PHAssetCollections to power our UI.</ul><h2 id="fetching-selected-albums-photo-assets"><span class="mr-2">Fetching Selected Album‚Äôs Photo Assets</span><a href="#fetching-selected-albums-photo-assets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To display the selected album‚Äôs photos in our mediaPickerView‚Äôs UI, navigate back to the <strong>ViewController.swift</strong> file. Locate the <strong>handleDidSelect</strong> method below the marked <strong>AlbumVCDelegate</strong> section and add the following code to it:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>
  <span class="kd">func</span> <span class="nf">handleDidSelect</span><span class="p">(</span><span class="nv">album</span><span class="p">:</span> <span class="kt">PHAssetCollection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">fetchOptions</span> <span class="o">=</span> <span class="kt">PHFetchOptions</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">sortDescriptor</span> <span class="o">=</span> <span class="kt">NSSortDescriptor</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"creationDate"</span><span class="p">,</span> <span class="nv">ascending</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
        <span class="n">fetchOptions</span><span class="o">.</span><span class="n">sortDescriptors</span> <span class="o">=</span> <span class="p">[</span><span class="n">sortDescriptor</span><span class="p">]</span>
        <span class="k">let</span> <span class="nv">fetchedAssets</span> <span class="o">=</span> <span class="kt">PHAsset</span><span class="o">.</span><span class="nf">fetchAssets</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">album</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">fetchOptions</span><span class="p">)</span>
        <span class="n">allPhotosInCurrentAlbum</span> <span class="o">=</span> <span class="n">fetchedAssets</span>
        <span class="n">mediaPickerView</span><span class="o">.</span><span class="nf">bindDataFromPhotosLibrary</span><span class="p">(</span><span class="nv">fetchedAssets</span><span class="p">:</span> <span class="n">allPhotosInCurrentAlbum</span><span class="p">,</span> <span class="nv">albumTitle</span><span class="p">:</span> <span class="n">album</span><span class="o">.</span><span class="n">localizedTitle</span> <span class="p">??</span> <span class="s">""</span><span class="p">)</span>
    <span class="p">}</span>
    
</pre></table></code></div></div><p>Pretty self-explanatory from our <a href="#Fetching-The-Assets">Fetching The Assets</a> section. Here we are simply fetching the selected album‚Äôs assets and passing it to our mediaPickerView for UI update.<br /> Now let‚Äôs run the project, open the albums and select any album, you should see the mediaPickerView‚Äôs photo assets update to display the selected album‚Äôs photos.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 800'%3E%3C/svg%3E" data-src="/assets/img/didSelectAlbumVid.gif" alt="Desktop View" class="shadow" width="800" height="800" data-proofer-ignore> <em>Hooray üôå‚úäü•≥üéâüëè we can now change albums!</em></p><ul class="task-list"><li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to Fetch all Photo Assets in a Specific Album.</ul><h2 id="searching-photo-library-assets-using-phpickerviewcontroller"><span class="mr-2">Searching Photo Library Assets Using PHPickerViewController</span><a href="#searching-photo-library-assets-using-phpickerviewcontroller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The first item in our smart album section is a search item. To mimic the instagram app‚Äôs design of this UX flow we will be using the PHPickerViewController. A view controller that was introduced in iOS 14+ as an alternative to UIImagePickerController for providing the user interface to search and pick photos from the photo library.<br /> The PHPickerViewController uses the traditional delegate model that will alert you upon user interation completion.</p><p>Still in the <strong>ViewController.swift</strong> file, locate the <strong>handlePresentPHPickerViewController</strong> method which is below the marked <strong>AlbumVCDelegate</strong> section and update it content to this:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">handlePresentPHPickerViewController</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 1</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">asyncAfter</span><span class="p">(</span><span class="nv">deadline</span><span class="p">:</span> <span class="o">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 2</span>
            <span class="k">var</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">PHPickerConfiguration</span><span class="p">(</span><span class="nv">photoLibrary</span><span class="p">:</span> <span class="kt">PHPhotoLibrary</span><span class="o">.</span><span class="nf">shared</span><span class="p">())</span>
            <span class="n">configuration</span><span class="o">.</span><span class="n">selectionLimit</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="c1">// 3</span>
            <span class="k">let</span> <span class="nv">picker</span> <span class="o">=</span> <span class="kt">PHPickerViewController</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
            <span class="n">picker</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">picker</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><ol><li><p>We are using the DispatchQueue‚Äôs async delay method to ensure that the AlbumVC was dismissed before we attempt to present the PHPickerViewController.</p><li><p>The PHPickerConfiguration enables us to set a multi-selection limit, which we set to 10.</p><li><p>We instantiate the PHPickerViewController and set it‚Äôs delegate before presenting it.</p></ol><blockquote class="prompt-info"><div><p><strong>Note:</strong> We can also filter the type of media that is presented to the user via PHPickerViewController by using <strong>configuration.filter = .images</strong> or <strong>configuration.filter = .any(of: [.livePhotos, .images])</strong>.</p></div></blockquote><h4 id="phpickerviewcontrollerdelegate"><span class="mr-2">PHPickerViewControllerDelegate</span><a href="#phpickerviewcontrollerdelegate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Just below the <strong>handlePresentPHPickerViewController</strong> method we have the marked <strong>PHPickerViewControllerDelegate</strong> section. Update the <strong>picker()</strong> method to this:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">picker</span><span class="p">(</span><span class="n">_</span> <span class="nv">picker</span><span class="p">:</span> <span class="kt">PHPickerViewController</span><span class="p">,</span> <span class="n">didFinishPicking</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">PHPickerResult</span><span class="p">])</span> <span class="p">{</span>
        <span class="c1">// 1</span>
        <span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">identifiers</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="nf">compactMap</span><span class="p">(\</span><span class="o">.</span><span class="n">assetIdentifier</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">fetchResult</span> <span class="o">=</span> <span class="kt">PHAsset</span><span class="o">.</span><span class="nf">fetchAssets</span><span class="p">(</span><span class="nv">withLocalIdentifiers</span><span class="p">:</span> <span class="n">identifiers</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="c1">// 2</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">mediaPickerView</span><span class="o">.</span><span class="nf">bindDataFromPhotosLibrary</span><span class="p">(</span><span class="nv">fetchedAssets</span><span class="p">:</span> <span class="n">fetchResult</span><span class="p">,</span> <span class="nv">albumTitle</span><span class="p">:</span> <span class="s">"Search Result"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><ol><li><p>First we dismiss the PHPickerViewController upon completion of asset selection. Then we retrieve the selected assets using PHAsset‚Äôs fetchAssets method with the assetIdentifier property.</p><li><p>We pass the retrieved assets off to be displayed by the mediaPickerView‚Äôs UI.</p></ol><p>Now let‚Äôs run the project, open the album and tap the search item. The PHPickerViewController will present a familiar UI of your photos and albums. Search and select photos and then tap the add button to dismiss. You should have something similar to this happening:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 800'%3E%3C/svg%3E" data-src="/assets/img/phPickerInPhoneDemo.gif" alt="Desktop View" class="shadow" width="800" height="800" data-proofer-ignore> <em>PHPickerViewController Search Demo</em></p><ul class="task-list"><li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to use PHPickerViewController to search and select specific assets.</ul><h2 id="listening-for-changes-using-phphotolibrarychangeobserver"><span class="mr-2">Listening For Changes Using PHPhotoLibraryChangeObserver</span><a href="#listening-for-changes-using-phphotolibrarychangeobserver" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that our app is running nicely let‚Äôs address how to handle changes in the photos library.<br /> We listen to changes in the photos library such as when a photo is deleted, added or edited by subscribing to the PHPhotoLibraryChangeObserver.<br /> According to Apple‚Äôs own documentation, the PHPhotoLibraryChangeObserver protocol notifies you of changes that occur in the photo library, regardless of whether those changes are made by your app, by a user in the Photos app, or by another app that uses the Photos framework.</p><h3 id="listening-for-changes-in-viewcontroller"><span class="mr-2">Listening For Changes in ViewController</span><a href="#listening-for-changes-in-viewcontroller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To register for updates in the <strong>ViewController.swift</strong> file navigate to the <strong>fetchPhotoLibraryAssets</strong> method. Add this registration code anywhere below the <strong>PHPhotoLibrary.authorizationStatus()</strong> logic:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">fetchPhotoLibraryAssets</span><span class="p">()</span> <span class="p">{</span>
            
  <span class="c1">// 1</span>
 <span class="k">let</span> <span class="nv">authStatus</span> <span class="o">=</span> <span class="kt">PHPhotoLibrary</span><span class="o">.</span><span class="nf">authorizationStatus</span><span class="p">()</span>
 <span class="k">guard</span> <span class="n">authStatus</span> <span class="o">==</span>  <span class="o">.</span><span class="n">authorized</span> <span class="o">||</span> <span class="n">authStatus</span> <span class="o">==</span> <span class="o">.</span><span class="n">limited</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
         
    <span class="c1">// ADD THIS LINE OF CODE BELOW 1.</span>
    <span class="c1">// Please note We are only subscribing to PHPhotoLibraryChangeObserver if we have authorization to access photo library.</span>
   <span class="kt">PHPhotoLibrary</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">register</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>

<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
  <span class="p">}</span>
  
</pre></table></code></div></div><p>With our ViewController.swift listening for changes. Add this in the <strong>deinit</strong> method to remove the listener.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">deinit</span> <span class="p">{</span>
  <span class="kt">PHPhotoLibrary</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">unregisterChangeObserver</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
<span class="p">}</span>
  
</pre></table></code></div></div><p>Scroll down to the end of the ViewController.swift file and conform to the PHPhotoLibraryChangeObserver protocol with the following code:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">//MARK: - PHPhotoLibraryChangeObserver</span>
<span class="kd">extension</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">PHPhotoLibraryChangeObserver</span>  <span class="p">{</span>
    <span class="c1">// 1.</span>
    <span class="kd">func</span> <span class="nf">photoLibraryDidChange</span><span class="p">(</span><span class="n">_</span> <span class="nv">changeInstance</span><span class="p">:</span> <span class="kt">PHChange</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="c1">// 2.</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">changeDetails</span> <span class="o">=</span> <span class="n">changeInstance</span><span class="o">.</span><span class="nf">changeDetails</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">allPhotosInCurrentAlbum</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">allPhotosInCurrentAlbum</span> <span class="o">=</span> <span class="n">changeDetails</span><span class="o">.</span><span class="n">fetchResultAfterChanges</span>
                <span class="c1">// 3.</span>
                <span class="k">self</span><span class="o">.</span><span class="n">mediaPickerView</span><span class="o">.</span><span class="nf">bindDataFromPhotosLibrary</span><span class="p">(</span><span class="nv">fetchedAssets</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">allPhotosInCurrentAlbum</span><span class="p">,</span> <span class="nv">albumTitle</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">mediaPickerView</span><span class="o">.</span><span class="nf">getCurrentAlbumTitle</span><span class="p">())</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
  
</pre></table></code></div></div><ol><li><p>The change observer has only one method: photoLibraryDidChange(:). Every time the photo library changes, it triggers this method.</p><li><p>We need to check if the update affects our <strong>allPhotosInCurrentAlbum</strong> assets. Using changeInstance, a property that describes the photo library changes, by calling its changeDetails(for:) method and passing in our asset. It returns nil if our <strong>allPhotosInCurrentAlbum</strong> assets is not affected by the changes. Otherwise, we retrieve the updated copy of the <strong>allPhotosInCurrentAlbum</strong> assets by calling fetchResultAfterChanges.</p><li><p>Refreshing the mediaPickerView‚Äôs UI to reflect the changes.</p></ol><h3 id="listening-for-changes-in-albumvc"><span class="mr-2">Listening For Changes in AlbumVC</span><a href="#listening-for-changes-in-albumvc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Similar to what we just did in the ViewController.swift file, let‚Äôs go to the AlbumVC.swift file to register for changes in album assets. Find the viewDidLoad method in the albumVC and modify it to this:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="nf">setUpTableView</span><span class="p">()</span>
        <span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">clear</span>
        <span class="c1">// ADD THIS TO VIEWDIDLOAD</span>
        <span class="k">let</span> <span class="nv">authStatus</span> <span class="o">=</span> <span class="kt">PHPhotoLibrary</span><span class="o">.</span><span class="nf">authorizationStatus</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">authStatus</span> <span class="o">==</span>  <span class="o">.</span><span class="n">authorized</span> <span class="o">||</span> <span class="n">authStatus</span> <span class="o">==</span> <span class="o">.</span><span class="n">limited</span> <span class="p">{</span>
            <span class="kt">PHPhotoLibrary</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">register</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>Here we are registring for changes only if we are authorized to access photo library.</p><p>Similar to before lets remove the ChangeObserver listener in the deinit method. Add this anywhere in the marked Init section of your AlbumVC:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">deinit</span> <span class="p">{</span>
        <span class="kt">PHPhotoLibrary</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">unregisterChangeObserver</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>Scroll down to the end of the AlbumVC.swift file and conform to the PHPhotoLibraryChangeObserver protocol with the following code:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">//MARK: - PHPhotoLibraryChangeObserver</span>
<span class="kd">extension</span> <span class="kt">AlbumVC</span><span class="p">:</span> <span class="kt">PHPhotoLibraryChangeObserver</span>  <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">photoLibraryDidChange</span><span class="p">(</span><span class="n">_</span> <span class="nv">changeInstance</span><span class="p">:</span> <span class="kt">PHChange</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="c1">//1. </span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">changeDetails</span> <span class="o">=</span> <span class="n">changeInstance</span><span class="o">.</span><span class="nf">changeDetails</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">userCreatedAlbums</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">userCreatedAlbums</span> <span class="o">=</span> <span class="n">changeDetails</span><span class="o">.</span><span class="n">fetchResultAfterChanges</span>
            <span class="p">}</span>
            <span class="k">self</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="nf">reloadData</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><ol><li>Since only the user-created album section has cover images, that‚Äôs the only assets we should be listening to for changes. We check if the update affects our userCreatedAlbums assets. Use changeInstance with it‚Äôs changeDetails(for:) method to retrieve the updated copy of the userCreatedAlbums assets by calling fetchResultAfterChanges.</ol><p>Voil√†! just like that our AlbumVC.swift and ViewController.swift files are now listening for any changes that occurs in the photo library!</p><ul class="task-list"><li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to use the PHPhotoLibraryChangeObserver protocol to keep our assets up to date.</ul><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 800'%3E%3C/svg%3E" data-src="https://c.tenor.com/93OUVuCIk6MAAAAC/done-and-done-spongebob.gif" alt="Desktop View" class="left" width="800" height="800" data-proofer-ignore></p><p><br /><br /> <br /><br /> <br /><br /> <br /><br /> <br /><br /> <br /><br /></p><h2 id="congratulations"><span class="mr-2">Congratulations!</span><a href="#congratulations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You did it! üôå‚úäü•≥üéâüëè you just replicated Instagram story‚Äôs custom photo picker. That was a lot to digest in a short time, hopefully you got a good introduction to the power of apple‚Äôs photokit framework. Remember to <a href="https://github.com/samisays11/InstaPhotoPicker"><strong>download the source code</strong></a>.</p><p>So far we‚Äôve covered:</p><ul class="task-list"><li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to Setup and Ask for User‚Äôs Photo Library Permission.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to Fetch Smart Albums and User-Created Albums.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to Fetch all Photo Assets in a Specific Album.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to Retrieve Images from Assets.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to use the retrieved PHAssets and PHAssetCollections to power our UI.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to use PHPickerViewController to search and select specific assets.<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />How to use the PHPhotoLibraryChangeObserver protocol to keep our assets up to date.</ul><h3 id="whats-next"><span class="mr-2">What‚Äôs Next?</span><a href="#whats-next" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The PhotoKit is a robust framework with much to offer. There is still so much we can do with the impressive library that‚Äôs beyond the scope of this tutorial. There are cool stuff like LivePhoto, video and the photo editing functionalities etc. Check out the <a href="https://developer.apple.com/documentation/photokit"><strong>Apple‚Äôs PhotoKit Documentation</strong></a> for more information.</p><p>That‚Äôs all folks, I hope you liked the tutorial üëã.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ios/'>iOS</a>, <a href='/categories/swift-tutorials/'>Swift Tutorials</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/photokit/" class="post-tag no-text-decoration" >photokit</a> <a href="/tags/phassetcollections/" class="post-tag no-text-decoration" >phassetcollections</a> <a href="/tags/phfetchresult/" class="post-tag no-text-decoration" >phfetchresult</a> <a href="/tags/phassets/" class="post-tag no-text-decoration" >phassets</a> <a href="/tags/custom-photo-picker/" class="post-tag no-text-decoration" >custom photo picker</a> <a href="/tags/uikit/" class="post-tag no-text-decoration" >uikit</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Let%27s+Build+a+Custom+Image+Picker+Just+like+Instagram+Stories+-+SamiSays11%27s+Blog&url=https%3A%2F%2Fsamisays11.github.io%2Fposts%2FHow-to-build-Instagram-PhotoPicker%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Let%27s+Build+a+Custom+Image+Picker+Just+like+Instagram+Stories+-+SamiSays11%27s+Blog&u=https%3A%2F%2Fsamisays11.github.io%2Fposts%2FHow-to-build-Instagram-PhotoPicker%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsamisays11.github.io%2Fposts%2FHow-to-build-Instagram-PhotoPicker%2F&text=Let%27s+Build+a+Custom+Image+Picker+Just+like+Instagram+Stories+-+SamiSays11%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/portfolio/">Portfolio Projects üíº</a><li><a href="/posts/How-to-build-Instagram-PhotoPicker/">Let's Build a Custom Image Picker Just like Instagram Stories</a><li><a href="/posts/How-to-remove-empty-albums/">How To Remove Empty PHAssetCollections from a PHFetchResult</a><li><a href="/posts/PHImagePicker/">The Modern iOS 14 Photo Picker</a><li><a href="/posts/drag-and-drop/">How to Drag & Reorder CollectionView Cells</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ios/">ios</a> <a class="post-tag" href="/tags/swift/">swift</a> <a class="post-tag" href="/tags/uikit/">uikit</a> <a class="post-tag" href="/tags/phassetcollections/">phassetcollections</a> <a class="post-tag" href="/tags/phassets/">phassets</a> <a class="post-tag" href="/tags/phfetchresult/">phfetchresult</a> <a class="post-tag" href="/tags/behavioral-engineering/">behavioral engineering</a> <a class="post-tag" href="/tags/consumer-behavior/">consumer behavior</a> <a class="post-tag" href="/tags/custom-photo-picker/">custom photo picker</a> <a class="post-tag" href="/tags/photokit/">photokit</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/How-to-remove-empty-albums/"><div class="card-body"> <em class="small" data-ts="1657480080" data-df="ll" > Jul 10, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How To Remove Empty PHAssetCollections from a PHFetchResult</h3><div class="text-muted small"><p> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 fileprivate var smartAlbums = PHFetchResult&amp;lt;PHAssetCollection&amp;gt;() fileprivate var userCreatedAlbums = PHFetchResult&amp;lt;PHAssetCollection&amp;gt;() filepr...</p></div></div></a></div><div class="card"> <a href="/posts/PHImagePicker/"><div class="card-body"> <em class="small" data-ts="1658171280" data-df="ll" > Jul 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Modern iOS 14 Photo Picker</h3><div class="text-muted small"><p> Prior to iOS 14, the quickest and simplest way to fetch photos from the user‚Äôs photo library was through the UIImagePickerController class. However, starting from iOS 14.0, Apple is providing us de...</p></div></div></a></div><div class="card"> <a href="/posts/drag-and-drop/"><div class="card-body"> <em class="small" data-ts="1658171280" data-df="ll" > Jul 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to Drag & Reorder CollectionView Cells</h3><div class="text-muted small"><p> Reordering Collection View Cells is a feature that was introduced in iOS 9. It is a surprisingly easy interaction to build, both in collectionviews and tableviews. By leveraging the UILongPressGest...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/My-2021-Readlist/" class="btn btn-outline-primary" prompt="Older"><p>The 18 Books I Read in 2021</p></a> <a href="/posts/How-to-remove-empty-albums/" class="btn btn-outline-primary" prompt="Newer"><p>How To Remove Empty PHAssetCollections from a PHFetchResult</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> ¬© 2022 <a href="https://twitter.com/samisays11">Osaretin Uyigue</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Created by Osaretin Uyigue</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ios/">ios</a> <a class="post-tag" href="/tags/swift/">swift</a> <a class="post-tag" href="/tags/uikit/">uikit</a> <a class="post-tag" href="/tags/phassetcollections/">phassetcollections</a> <a class="post-tag" href="/tags/phassets/">phassets</a> <a class="post-tag" href="/tags/phfetchresult/">phfetchresult</a> <a class="post-tag" href="/tags/behavioral-engineering/">behavioral engineering</a> <a class="post-tag" href="/tags/consumer-behavior/">consumer behavior</a> <a class="post-tag" href="/tags/custom-photo-picker/">custom photo picker</a> <a class="post-tag" href="/tags/photokit/">photokit</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
