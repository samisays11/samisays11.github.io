<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="The Modern iOS 14 Photo Picker" /><meta name="author" content="Osaretin" /><meta property="og:locale" content="en" /><meta name="description" content="Prior to iOS 14, the quickest and simplest way to fetch photos from the user‚Äôs photo library was through the UIImagePickerController class. However, starting from iOS 14.0, Apple is providing us developers a new way to access the user‚Äôs photo library using the new PHPickerViewController class. A reusable class built on top of the PhotosUI framework rather than UIKit. It makes photo and video selection a much modern experience for apps." /><meta property="og:description" content="Prior to iOS 14, the quickest and simplest way to fetch photos from the user‚Äôs photo library was through the UIImagePickerController class. However, starting from iOS 14.0, Apple is providing us developers a new way to access the user‚Äôs photo library using the new PHPickerViewController class. A reusable class built on top of the PhotosUI framework rather than UIKit. It makes photo and video selection a much modern experience for apps." /><link rel="canonical" href="https://samisays11.github.io/posts/PHImagePicker/" /><meta property="og:url" content="https://samisays11.github.io/posts/PHImagePicker/" /><meta property="og:site_name" content="SamiSays11‚Äôs Blog" /><meta property="og:image" content="https://samisays11.github.io/assets/img/phpicker.png" /><meta property="og:image:height" content="400" /><meta property="og:image:width" content="1000" /><meta property="og:image:alt" content="PHPicker" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-18T14:08:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://samisays11.github.io/assets/img/phpicker.png" /><meta name="twitter:image:alt" content="PHPicker" /><meta property="twitter:title" content="The Modern iOS 14 Photo Picker" /><meta name="twitter:site" content="@samisays11" /><meta name="twitter:creator" content="@Osaretin" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Osaretin"},"dateModified":"2022-07-27T10:53:44-05:00","datePublished":"2022-07-18T14:08:00-05:00","description":"Prior to iOS 14, the quickest and simplest way to fetch photos from the user‚Äôs photo library was through the UIImagePickerController class. However, starting from iOS 14.0, Apple is providing us developers a new way to access the user‚Äôs photo library using the new PHPickerViewController class. A reusable class built on top of the PhotosUI framework rather than UIKit. It makes photo and video selection a much modern experience for apps.","headline":"The Modern iOS 14 Photo Picker","image":{"width":1000,"height":400,"alt":"PHPicker","url":"https://samisays11.github.io/assets/img/phpicker.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://samisays11.github.io/posts/PHImagePicker/"},"url":"https://samisays11.github.io/posts/PHImagePicker/"}</script><title>The Modern iOS 14 Photo Picker | SamiSays11's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="SamiSays11's Blog"><meta name="application-name" content="SamiSays11's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">SamiSays11's Blog</a></div><div class="site-subtitle font-italic">In teaching, we learn twice.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/samisays11" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/samisays11" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['samuel.uyigue','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>The Modern iOS 14 Photo Picker</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>The Modern iOS 14 Photo Picker</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1658171280" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 18, 2022 </em> </span> <span> Updated <em class="" data-ts="1658937224" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 27, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="/assets/img/phpicker.png" class="preview-img bg" alt="PHPicker" width="1000" height="400" data-proofer-ignore><figcaption class="pt-2 pb-2">PHPicker</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> Osaretin Uyigue </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1256 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>Prior to iOS 14, the quickest and simplest way to fetch photos from the user‚Äôs photo library was through the UIImagePickerController class. However, starting from iOS 14.0, Apple is providing us developers a new way to access the user‚Äôs photo library using the new <strong>PHPickerViewController</strong> class. A reusable class built on top of the PhotosUI framework rather than UIKit. It makes photo and video selection a much modern experience for apps.</p><h2 id="why-even-use-phpickerviewcontroller"><span class="mr-2">Why Even Use PHPickerViewController?</span><a href="#why-even-use-phpickerviewcontroller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Unless your app still supports anything below iOS 14, dumping the old guard of UIImagePickerController should be very easy when you consider some of the disadvantages that came with the old guy.<br /> The old UIImagePickerController was fairly basic and limited. It had no search or filtering functionality and did not support multi-item selection. Although the UIImagePickerController class is not currently deprecated, if you look at the header file you‚Äôll see the API marked with this:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kt">API_DEPRECATED</span><span class="p">(</span><span class="s">"Will be removed in a future release, use PHPicker."</span><span class="p">,</span> <span class="nf">ios</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="kt">API_TO_BE_DEPRECATED</span><span class="p">));</span>

</pre></table></code></div></div><p>So expect deprecation in future updates.</p><h2 id="whats-the-buzz"><span class="mr-2">What‚Äôs the Buzz</span><a href="#whats-the-buzz" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Here‚Äôs a list of why PHPickerViewController is awesome</p><ol><li><strong>No more permission alerts</strong>. Developer don‚Äôt have to specify the Privacy - Photo Library Usage Description key in the info.plist file anymore, because there won‚Äôt be any need for alert views that‚Äôs asking for permission.<li><strong>Runs in a separate process</strong>. Although the PHPickerViewController might appear to be present inside the host app, it runs in a separate process.<li><strong>Built-in privacy</strong>. Since PHPickerViewController runs in a separate process, only the content selected by the user is shared with the Host App. Unlike the UIImagePickerViewController, you can‚Äôt programmatically take a screenshot of this picker view or access any content that‚Äôs not selected by the user.<li><strong>Built-in search</strong>. Searching photos is a built-in feature in PHPickerViewController, and the UI is similar to that of the Photos app.<li><strong>Multi-selection</strong>. PHPickerViewController comes equiped with multi-selection capabilty and also allows the developer to limit the number of photos a user can select by setting the <strong>selectionLimit</strong> property in PHPickerConfiguration.</ol><h2 id="implementing-phpickerviewcontroller"><span class="mr-2">Implementing PHPickerViewController</span><a href="#implementing-phpickerviewcontroller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Getting started with the new PHPickerViewController API is pretty straightforward. It requires a configuration and uses the traditional delegate model to alert‚Äôs us when item selection is complete.</p><p>The <mark>PHPickerViewController</mark> takes an instance of <mark>PHPickerConfiguration</mark> as an initializer argument.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>     <span class="k">var</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">PHPickerConfiguration</span><span class="p">()</span>
     <span class="k">let</span> <span class="nv">picker</span> <span class="o">=</span> <span class="kt">PHPickerViewController</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
</pre></table></code></div></div><h3 id="phpickerconfiguration"><span class="mr-2">PHPickerConfiguration</span><a href="#phpickerconfiguration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The <mark>PHPickerConfiguration</mark> provides us with three properties we can use to customize the PHPickerViewController.</p><ol><li><p><strong>selectionLimit</strong> - This property specifies the number of items a user can select. The default value is 1, while the value 0 specifies unlimited selection. The below configuration limits the selection to 10 items.</p><li><p><strong>filter</strong> - This property restricts the type of items that can be displayed (images, livePhotos or videos). Setting the value to nil will display all the supported items. The below configuration displays only the live photos and images.</p><li><p><strong>preferredAssetRepresentationMode</strong> - This determines how an item provider should represent an asset. The default value is automatic. The below configuration sets the asset‚Äôs representation mode to automatic.</p></ol><blockquote><p class="prompt-info"><strong>Note:</strong> By default the selectionLimit is set to 1, and there is no filter.</p></blockquote><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// remember to import PhotosUI</span>

        <span class="k">var</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">PHPickerConfiguration</span><span class="p">()</span>
        <span class="n">configuration</span><span class="o">.</span><span class="n">selectionLimit</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">configuration</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="o">.</span><span class="nf">any</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">images</span><span class="p">,</span><span class="o">.</span><span class="n">livePhotos</span><span class="p">])</span>
        <span class="n">configuration</span><span class="o">.</span><span class="n">preferredAssetRepresentationMode</span> <span class="o">=</span> <span class="o">.</span><span class="n">automatic</span>
        <span class="k">let</span> <span class="nv">picker</span> <span class="o">=</span> <span class="kt">PHPickerViewController</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
        <span class="n">picker</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="nf">present</span><span class="p">(</span><span class="n">picker</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>

</pre></table></code></div></div><h3 id="phpickerviewcontrollerdelegate"><span class="mr-2">PHPickerViewControllerDelegate</span><a href="#phpickerviewcontrollerdelegate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Accessing selected items from the PHPickerViewController is simply a matter of implementing the <mark> PHPickerViewControllerDelegate </mark>, which has just one method:</p><p><strong>picker‚Äôs didFinishPicking method</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre> <span class="kd">func</span> <span class="nf">picker</span><span class="p">(</span><span class="n">_</span> <span class="nv">picker</span><span class="p">:</span> <span class="kt">PHPickerViewController</span><span class="p">,</span> <span class="n">didFinishPicking</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">PHPickerResult</span><span class="p">])</span> <span class="p">{</span>

 <span class="p">}</span>
</pre></table></code></div></div><p>The method comes with a result object which is an array of type PHPickerResult which contains an object of NSItemProvider. Now let‚Äôs see how we can parse selected images from this item provider object.</p><p><strong>Parsing Selected Images from ItemProvider</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>
<span class="kd">func</span> <span class="nf">picker</span><span class="p">(</span><span class="n">_</span> <span class="nv">picker</span><span class="p">:</span> <span class="kt">PHPickerViewController</span><span class="p">,</span> <span class="n">didFinishPicking</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">PHPickerResult</span><span class="p">])</span> <span class="p">{</span>

    <span class="c1">// Please note that your app is responsible for the presentation and dismissal of the picker. The picker does not manage the display itself.</span>
    <span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="k">guard</span> <span class="o">!</span><span class="n">results</span><span class="o">.</span><span class="n">isEmpty</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

    <span class="k">for</span> <span class="n">result</span> <span class="k">in</span> <span class="n">results</span> <span class="p">{</span>

        <span class="k">let</span> <span class="nv">itemProvider</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">itemProvider</span>

        <span class="k">if</span> <span class="n">itemProvider</span><span class="o">.</span><span class="nf">canLoadObject</span><span class="p">(</span><span class="nv">ofClass</span><span class="p">:</span> <span class="kt">UIImage</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>

            <span class="n">itemProvider</span><span class="o">.</span><span class="nf">loadObject</span><span class="p">(</span><span class="nv">ofClass</span><span class="p">:</span> <span class="kt">UIImage</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>

                <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>

                    <span class="k">if</span> <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="n">image</span> <span class="k">as?</span> <span class="kt">UIImage</span> <span class="p">{</span>

                        <span class="c1">// WE NOW HAVE THE UIIMAGE OBJECT</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>The for loop will go through all selected items in the returned results, and process all items by checking if the itemProvider can load a UIImage object.</p><blockquote><p><strong>Note:</strong> There is no support for automatic compression. The picker‚Äôs itemProvider will always return the original image with full dimensions. It‚Äôs up to the developer to perform necessary compressions or edition.</p></blockquote><h2 id="parsing-livephotos"><span class="mr-2">Parsing LivePhotos</span><a href="#parsing-livephotos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Parsing live photos is quite similar to parsing images. The PhotosUI framework provides us with a <mark> PHLivePhoto </mark> object that can be used to load live photos from the itemProvider:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">itemProvider</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">itemProvider</span>

<span class="k">if</span> <span class="n">itemProvider</span><span class="o">.</span><span class="nf">canLoadObject</span><span class="p">(</span><span class="nv">ofClass</span><span class="p">:</span> <span class="kt">PHLivePhoto</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>

   <span class="n">itemProvider</span><span class="o">.</span><span class="nf">loadObject</span><span class="p">(</span><span class="nv">ofClass</span><span class="p">:</span> <span class="kt">PHLivePhoto</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">livePhoto</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>

      <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        
         <span class="k">if</span> <span class="k">let</span> <span class="nv">livePhoto</span> <span class="o">=</span> <span class="n">livePhoto</span> <span class="k">as?</span> <span class="kt">PHLivePhoto</span> <span class="p">{</span>
              <span class="c1">// WE NOW HAVE ACCESS TO THE SELECTED LIVE PHOTO</span>
            <span class="p">}</span>
          <span class="p">}</span>
       <span class="p">}</span>
    <span class="p">}</span>

</pre></table></code></div></div><blockquote><p><strong>Note:</strong> The PhotosUI framework provides us with a <mark> PHLivePhotoView </mark> class that we can use to display livePhotos.</p></blockquote><h2 id="parsing-videos"><span class="mr-2">Parsing Videos</span><a href="#parsing-videos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Parsing videos is a little more work compared to photos and livePhotos.<br /> First we check itemProvider for item that conforms to ‚Äúpublic.movie‚Äù through a <mark> UTType.movie.identifier </mark> string. Then we use the itemProvider‚Äôs loadFileRepresentation(forTypeIdentifier: ) method to load and copy the video‚Äôs url.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre> <span class="k">let</span> <span class="nv">movieTypeIdentifier</span> <span class="o">=</span> <span class="kt">UTType</span><span class="o">.</span><span class="n">movie</span><span class="o">.</span><span class="n">identifier</span>

    <span class="k">if</span> <span class="n">itemProvider</span><span class="o">.</span><span class="nf">hasItemConformingToTypeIdentifier</span><span class="p">(</span><span class="n">movieTypeIdentifier</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">itemProvider</span><span class="o">.</span><span class="nf">loadFileRepresentation</span><span class="p">(</span><span class="nv">forTypeIdentifier</span><span class="p">:</span> <span class="n">movieTypeIdentifier</span><span class="p">)</span> <span class="p">{[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">url</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span><span class="p">{</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>
            
            <span class="c1">// receiving the video-local-URL / filepath</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">url</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
            
            <span class="c1">// create a new filename</span>
            <span class="k">let</span> <span class="nv">fileName</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="kt">Int</span><span class="p">(</span><span class="kt">Date</span><span class="p">()</span><span class="o">.</span><span class="n">timeIntervalSince1970</span><span class="p">)</span><span class="se">)</span><span class="s">.</span><span class="se">\(</span><span class="n">url</span><span class="o">.</span><span class="n">pathExtension</span><span class="se">)</span><span class="s">"</span>
            
            <span class="c1">// create new URL</span>
            <span class="k">let</span> <span class="nv">storedVideoUrl</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">fileURLWithPath</span><span class="p">:</span> <span class="kt">NSTemporaryDirectory</span><span class="p">()</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">)</span>
            
            <span class="c1">// copy item to APP Storage</span>
            <span class="k">try</span><span class="p">?</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">copyItem</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">storedVideoUrl</span><span class="p">)</span>
            
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="c1">// WE NOW HAVE ACCESS TO OUR VIDEO'S URL in storedVideoUrl</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><h2 id="final-tip"><span class="mr-2">Final Tip</span><a href="#final-tip" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If your configuration‚Äôs filter allows the user to choose any type of asset ‚Äî a video, a live photo, or a normal photo ‚Äî you‚Äôre going to want to distinguish what type the user actually chose. This turns out to be no simple matter.</p><p>After a great deal of experimentation and reading around, I‚Äôve settled on a formula like this:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// itemProvider is the PHPickerResult's itemProvider</span>
    <span class="k">if</span> <span class="n">itemProvider</span><span class="o">.</span><span class="nf">hasItemConformingToTypeIdentifier</span><span class="p">(</span><span class="kt">UTType</span><span class="o">.</span><span class="n">movie</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// it's a video</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">itemProvider</span><span class="o">.</span><span class="nf">canLoadObject</span><span class="p">(</span><span class="nv">ofClass</span><span class="p">:</span> <span class="kt">PHLivePhoto</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// it's a live photo</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">itemProvider</span><span class="o">.</span><span class="nf">canLoadObject</span><span class="p">(</span><span class="nv">ofClass</span><span class="p">:</span> <span class="kt">UIImage</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// it's a photo</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>In that code, the order of the tests is deliberate. A live photo can be supplied in a simple UIImage representation, so if we test for images before live photos, we won‚Äôt learn that the result is a live photo.</p><h2 id="drawbacks"><span class="mr-2">Drawbacks</span><a href="#drawbacks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Although the PHPickerViewController offers a modern privacy-centric API that allows us to access photos and videos, It‚Äôs important to note that it currently does not offer any photo or video capturing capability. We still rely on it‚Äôs predecessor the UIImagePickerController for that.</p><h2 id="resources"><span class="mr-2">Resources</span><a href="#resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://github.com/samisays11/PHPickerViewController-Demo"><strong>Sample PHPicker Project</strong></a><li><a href="https://developer.apple.com/videos/play/wwdc2020/10652/"><strong>Apple‚Äôs WWDC Video Resource</strong></a><li><a href="https://www.biteinteractive.com/picking-a-photo-in-ios-14/"><strong>Another Great Article On The Topic</strong></a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ios/'>iOS</a>, <a href='/categories/swift-tutorials/'>Swift Tutorials</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/phpickerviewcontroller/" class="post-tag no-text-decoration" >phpickerviewController</a> <a href="/tags/phassetcollections/" class="post-tag no-text-decoration" >phassetcollections</a> <a href="/tags/phfetchresult/" class="post-tag no-text-decoration" >phfetchresult</a> <a href="/tags/phassets/" class="post-tag no-text-decoration" >phassets</a> <a href="/tags/photo-picker/" class="post-tag no-text-decoration" >photo picker</a> <a href="/tags/uikit/" class="post-tag no-text-decoration" >uikit</a> <a href="/tags/phpicker/" class="post-tag no-text-decoration" >phpicker</a> <a href="/tags/photosui/" class="post-tag no-text-decoration" >photosui</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=The+Modern+iOS+14+Photo+Picker+-+SamiSays11%27s+Blog&url=https%3A%2F%2Fsamisays11.github.io%2Fposts%2FPHImagePicker%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=The+Modern+iOS+14+Photo+Picker+-+SamiSays11%27s+Blog&u=https%3A%2F%2Fsamisays11.github.io%2Fposts%2FPHImagePicker%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsamisays11.github.io%2Fposts%2FPHImagePicker%2F&text=The+Modern+iOS+14+Photo+Picker+-+SamiSays11%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/portfolio/">Portfolio Projects üíº</a><li><a href="/posts/How-to-build-Instagram-PhotoPicker/">Let's Build a Custom Image Picker Just like Instagram Stories</a><li><a href="/posts/How-to-remove-empty-albums/">How To Remove Empty PHAssetCollections from a PHFetchResult</a><li><a href="/posts/PHImagePicker/">The Modern iOS 14 Photo Picker</a><li><a href="/posts/drag-and-drop/">How to Drag & Reorder CollectionView Cells</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ios/">ios</a> <a class="post-tag" href="/tags/swift/">swift</a> <a class="post-tag" href="/tags/uikit/">uikit</a> <a class="post-tag" href="/tags/phassetcollections/">phassetcollections</a> <a class="post-tag" href="/tags/phassets/">phassets</a> <a class="post-tag" href="/tags/phfetchresult/">phfetchresult</a> <a class="post-tag" href="/tags/behavioral-engineering/">behavioral engineering</a> <a class="post-tag" href="/tags/consumer-behavior/">consumer behavior</a> <a class="post-tag" href="/tags/custom-photo-picker/">custom photo picker</a> <a class="post-tag" href="/tags/photokit/">photokit</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/How-to-build-Instagram-PhotoPicker/"><div class="card-body"> <em class="small" data-ts="1656300780" data-df="ll" > Jun 26, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Let's Build a Custom Image Picker Just like Instagram Stories</h3><div class="text-muted small"><p> What Are We Building ? In this tutorial, i will walk you through how to build a clone of Instagram‚Äôs Story Photo Picker feature. If you are not familiar with what that looks like there is a gif de...</p></div></div></a></div><div class="card"> <a href="/posts/How-to-remove-empty-albums/"><div class="card-body"> <em class="small" data-ts="1657480080" data-df="ll" > Jul 10, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How To Remove Empty PHAssetCollections from a PHFetchResult</h3><div class="text-muted small"><p> fileprivate var smartAlbums = PHFetchResult&amp;lt;PHAssetCollection&amp;gt;() fileprivate var userCreatedAlbums = PHFetchResult&amp;lt;PHAssetCollection&amp;gt;() fileprivate func fetchPhotoAssets(){ /* fetches...</p></div></div></a></div><div class="card"> <a href="/posts/drag-and-drop/"><div class="card-body"> <em class="small" data-ts="1658171280" data-df="ll" > Jul 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to Drag & Reorder CollectionView Cells</h3><div class="text-muted small"><p> Reordering Collection View Cells is a feature that was introduced in iOS 9. It is a surprisingly easy interaction to build, both in collectionviews and tableviews. By leveraging the UILongPressGest...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/How-to-remove-empty-albums/" class="btn btn-outline-primary" prompt="Older"><p>How To Remove Empty PHAssetCollections from a PHFetchResult</p></a> <a href="/posts/drag-and-drop/" class="btn btn-outline-primary" prompt="Newer"><p>How to Drag & Reorder CollectionView Cells</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> ¬© 2022 <a href="https://twitter.com/samisays11">Osaretin Uyigue</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Created by Osaretin Uyigue</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ios/">ios</a> <a class="post-tag" href="/tags/swift/">swift</a> <a class="post-tag" href="/tags/uikit/">uikit</a> <a class="post-tag" href="/tags/phassetcollections/">phassetcollections</a> <a class="post-tag" href="/tags/phassets/">phassets</a> <a class="post-tag" href="/tags/phfetchresult/">phfetchresult</a> <a class="post-tag" href="/tags/behavioral-engineering/">behavioral engineering</a> <a class="post-tag" href="/tags/consumer-behavior/">consumer behavior</a> <a class="post-tag" href="/tags/custom-photo-picker/">custom photo picker</a> <a class="post-tag" href="/tags/photokit/">photokit</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
